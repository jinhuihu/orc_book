name: Android CI/CD

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½® JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: æˆäºˆ gradlew æ‰§è¡Œæƒé™
      run: chmod +x gradlew

    - name: æ„å»º Debug APK
      run: ./gradlew assembleDebug

    - name: æ„å»º Release APK
      run: ./gradlew assembleRelease

    - name: ä¸Šä¼  Debug APK
      uses: actions/upload-artifact@v4
      with:
        name: app-debug
        path: app/build/outputs/apk/debug/app-debug.apk

    - name: ä¸Šä¼  Release APK
      uses: actions/upload-artifact@v4
      with:
        name: app-release-unsigned
        path: app/build/outputs/apk/release/app-release-unsigned.apk

    - name: åˆ›å»º Releaseï¼ˆä»…åœ¨æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶ï¼‰
      if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: Release v1.0.${{ github.run_number }}
        body: |
          ## ğŸ“± ä¹¦ç±æ‰«æå™¨
          
          ### åŠŸèƒ½ç‰¹æ€§
          - ğŸ“· æ‰«æä¹¦ç±å°é¢
          - ğŸ” OCRè¯†åˆ«ä¹¦å
          - ğŸ“Š æ‰¹é‡å¯¼å‡ºExcel
          
          ### ä¸‹è½½è¯´æ˜
          - **app-debug.apk**: è°ƒè¯•ç‰ˆæœ¬ï¼ˆæ¨èæµ‹è¯•ä½¿ç”¨ï¼‰
          - **app-release-unsigned.apk**: å‘å¸ƒç‰ˆæœ¬ï¼ˆæœªç­¾åï¼‰
          
          æ„å»ºæ—¶é—´: ${{ github.event.head_commit.timestamp }}
          æäº¤ä¿¡æ¯: ${{ github.event.head_commit.message }}
        files: |
          app/build/outputs/apk/debug/app-debug.apk
          app/build/outputs/apk/release/app-release-unsigned.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

